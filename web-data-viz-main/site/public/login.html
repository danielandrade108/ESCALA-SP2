<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESCALA - SP</title>
    <link rel="stylesheet" href="css/login.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <header>
        <div class="header">
            <div class="container">
                <a href="index.html"><img class="logo" src="imgs/nome_logo.png"></a>

                <!-- <img src="imgs/Logo.png"> -->

                <div class="links">
                    <div class="marginMaior">
                        <ul>
                            <li><a href="index.html#corpoHistoria">História</a></li>
                            <li><img src="imgs/linha.png"></li>
                            <li><a href="sobreMim.html">Sobre mim</a></li>
                        </ul>
                    </div>
                    <ul>
                        <a href="login.html">
                            <li><img style="width: 30px" , height="30px" src="imgs/login_camisa.png"></li>
                            <li><span>Login</span></li>
                        </a>
                </div>
            </div>
        </div>
    </header>

    <div class="corpo">
        <div id="div_login" class="campoLogin">
            <div class="lado">

                <img class="tituloMenor" src="imgs/titulo_login.png">

                <div class="camposEntrada">
                    <div class="campo">
                        <span>E-mail:</span>
                        <input id="ipt_emailLogin" type="text" placeholder="E-mail">
                    </div>
                    <div class="campo">
                        <span>Senha:</span>
                        <input id="ipt_senhaLogin" type="text" placeholder="******">
                    </div>
                </div>

                <button class="botao" onclick="entrar()">Login</button>
            </div>

            <div class="linhaLogo">
                <img src="imgs/linha_logo.png">
            </div>

            <div class="lado">
                <img id="tituloCadastro" onclick="paraCadastro()" class="tituloMaior" src="imgs/titulo_cadastro.png">
            </div>
        </div>

        <div id="div_cadastro" class="campoCadastro" style="display: none;">
            <div class="lado">
                <img id="tituloLogin" onclick="paraLogin()" class="tituloMaior" src="imgs/titulo_login.png">

            </div>

            <div class="linhaLogo">
                <img src="imgs/linha_logo.png">
            </div>

            <div class="lado">
                <img class="tituloMenor" src="imgs/titulo_cadastro.png">

                <div class="camposEntrada">
                    <div class="campo">
                        <span>Nome:</span>
                        <input id="ipt_nomeCadastro" type="text" placeholder="Seu nome">
                    </div>
                    <div class="campo">
                        <span>E-mail:</span>
                        <input id="ipt_emailCadastro" type="text" placeholder="E-mail">
                    </div>
                    <!-- <div class="campo">
                        <span>Telefone:</span>
                        <input id="ipt_telefoneCadastro" type="text" placeholder="(11)99999-9999">
                    </div> -->
                    <div class="campo">
                        <span>Senha:</span>
                        <input id="ipt_senhaCadastro" type="text" placeholder="******">
                    </div>
                    <div class="campo">
                        <span>Confirmar Senha:</span>
                        <input id="ipt_confSenhaCadastro" type="text" placeholder="******">
                    </div>
                </div>

                <button class="botao" onclick="cadastrar()">Cadastrar</button>

            </div>
        </div>

        <div id="alerta" style="display: none;" class="alerta">
            <div class="alertaCorpo">
                <img id="alertaImg" class="alertaImg">
                <span id="alertaText" class="alertaText"></span>
            </div>
        </div>
    </div>




</body>

</html>

<script>
    var emailLogin = '';
    var senhaLogin = '';

    var nomeCadastro = '';
    var emailCadastro = '';
    var senhaCadastro = '';
    var confSenhaCadastro = '';

    function paraCadastro() {
        div_login.style.display = 'none';
        div_cadastro.style.display = 'flex';
        tituloCadastro.style.cursor = 'pointer';
    }

    function paraLogin() {
        div_cadastro.style.display = 'none';
        div_login.style.display = 'flex';
        tituloLogin.style.cursor = 'pointer';
    }

    var erroLogin = false;
    var testando = 12;


    function alertaErroVazio() {
        alertaText.innerHTML = 'Prencha os campos vazios'
        alertaText.style.color = '#DE0209'
        alertaImg.src = 'imgs/error_sp.png'
        alerta.style.display = 'flex'
        alerta.style.backgroundColor = '#D9D9D9'
        alerta.style.borderColor = '#DE0209'

        setTimeout(() => {
                    alerta.style.display = 'none'
                }, "3000")
    }

    function alertaErroEmail() {
        alertaText.innerHTML = 'E-mail inválido'
        alertaText.style.color = '#DE0209'
        alertaImg.src = 'imgs/error_sp.png'
        alerta.style.display = 'flex'
        alerta.style.backgroundColor = '#D9D9D9'
        alerta.style.borderColor = '#DE0209'

        setTimeout(() => {
                    alerta.style.display = 'none'
                }, "3000")
    }

    function alertaErroSenha() {
        alertaText.innerHTML = 'Senhas não correspondem'
        alertaText.style.color = '#DE0209'
        alertaImg.src = 'imgs/error_sp.png'
        alerta.style.display = 'flex'
        alerta.style.backgroundColor = '#D9D9D9'
        alerta.style.borderColor = '#DE0209'

        setTimeout(() => {
                    alerta.style.display = 'none'
                }, "3000")
    }

    function alertaLoginErro() {
        alertaText.innerHTML = 'Login não existe'
        alertaText.style.color = '#DE0209'
        alertaImg.src = 'imgs/error_sp.png'
        alerta.style.display = 'flex'
        alerta.style.backgroundColor = '#D9D9D9'
        alerta.style.borderColor = '#DE0209'
    }

    function alertaLoginSucesso() {
        alertaText.innerHTML = `Bem vindo ${sessionStorage.NOME_LOGIN}!`
        alertaText.style.color = 'black'
        alertaImg.src = 'imgs/certo_sp.png'
        alerta.style.display = 'flex'
        alerta.style.backgroundColor = '#D9D9D9'
        alerta.style.borderColor = 'black'
    }


    function alertaCadastroSucesso() {
        alertaText.innerHTML = `Conta cadastrada com sucesso!`
        alertaText.style.color = 'black'
        alertaImg.src = 'imgs/certo_sp.png'
        alerta.style.display = 'flex'
        alerta.style.backgroundColor = '#D9D9D9'
        alerta.style.borderColor = 'black'

        setTimeout(() => {
                    alerta.style.display = 'none'
                }, "2000")
    }

    function entrar() {

        emailLogin = ipt_emailLogin.value;
        senhaLogin = ipt_senhaLogin.value;

        if (emailLogin == '' || senhaLogin == '') {
  
            alertaErroVazio()

            setTimeout(() => {
                alerta.style.display = 'none'
            }, "3000");
            erroLogin = true;
        } else
            if (emailLogin.indexOf('@') == -1) {

                alertaErroEmail()

                setTimeout(() => {
                    alerta.style.display = 'none'
                }, "3000");
                erroLogin = true;
            } else {
                erroLogin = false;
            }

        if (erroLogin == false) {

            fetch("/usuarios/autenticar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    emailServer: emailLogin,
                    senhaServer: senhaLogin
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO entrar()!")

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        sessionStorage.EMAIL_LOGIN = json[0].email;
                        sessionStorage.SENHA_LOGIN = json[0].senha;
                        sessionStorage.ID_LOGIN = json[0].idLogin;
                        sessionStorage.NUM_CAMPO = json[0].fkFormacao;
                        sessionStorage.JOGADOR_PREF = json[0].jogadorPref;
                        sessionStorage.NOME_LOGIN = json[0].nomeUsuario;

                        ipt_emailLogin.value = '';
                        ipt_senhaLogin.value = '';

                        alertaLoginSucesso()

                        if (sessionStorage.NUM_CAMPO == 'null') {
                            setTimeout(() => {
                                window.location.href = "escalacao.html";
                            }, "1000");
                        } else {
                            setTimeout(() => {
                                window.location.href = "dashboard/dashboard.html";
                            }, "1000");

                        }

                    });

                } else {

                    alertaLoginErro()

                    console.log("Houve um erro ao tentar realizar o login!");

                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            })

            return false;
        }
    }

    var erroCadastro = false;

    function cadastrar() {

        nomeCadastro = ipt_nomeCadastro.value;
        emailCadastro = ipt_emailCadastro.value;
        senhaCadastro = ipt_senhaCadastro.value;
        confSenhaCadastro = ipt_confSenhaCadastro.value;

        if (nomeCadastro == '' || emailCadastro == '' || senhaCadastro == '' || confSenhaCadastro == '') {
            alertaErroVazio()
            erroCadastro = true;
        } else
            if (emailCadastro.indexOf('@') == -1) {
                alertaErroEmail()
                erroCadastro = true;
            } else
                if (senhaCadastro != confSenhaCadastro) {
                    alertaErroSenha()
                    erroCadastro = true;
                } else {
                    erroCadastro = false;
                }

        if (erroCadastro == false) {

            ipt_nomeCadastro.value = '';
            ipt_emailCadastro.value = '';
            ipt_senhaCadastro.value = '';
            ipt_confSenhaCadastro.value = '';


            fetch("/usuarios/cadastrarLogin", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    emailServer: emailCadastro,
                    senhaServer: senhaCadastro
                })
            }).then(function (resposta) {

                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    fetch("/usuarios/cadastrarUsuario", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            nomeServer: nomeCadastro
                        })
                    }).then(function (resposta) {

                        console.log("resposta: ", resposta);

                        if (resposta.ok) {

                            alertaCadastroSucesso()

                            setTimeout(() => {
                                div_cadastro.style.display = 'none';
                                div_login.style.display = 'flex';
                                tituloLogin.style.cursor = 'pointer';
                            }, "2000")


                        } else {
                            throw ("Houve um erro ao tentar realizar o cadastro!");
                        }
                    }).catch(function (resposta) {
                        console.log(`#ERRO: ${resposta}`);
                    });

                    return false;


                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

            return false;



        }
    }

</script>



<!-- div_cadastro.style.display = 'none';
div_login.style.display = 'flex';
tituloLogin.style.cursor = 'pointer'; -->